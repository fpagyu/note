## memcache内核(面试)

> [From](https://mp.weixin.qq.com/s/zh9fq_e2BgdIeR8RKtY6Sg)


### 第一类问题: 知道不知道

*memcache基础特性*

1. mc的核心职能是KV内存管理, value存储最大为1M, 不支持复杂数据结构(哈希, 列表, 集合...);
2. mc不支持持久化;
3. mc支持key过期;
4. mc持续运行很少会出现内存碎片, 速度不会随着服务运行时间降低;
5. mc使用非阻塞IO复用网络模型, 使用监听线程/工作线程的多线程模型;

### 第二类问题: 为什么(why), 什么(what)

#### 1. memcache为什么不支持复杂数据结构?为什么不支持持久化?

业务决定技术方案, mc的诞生, 以"以服务的方式, 而不是库的方式管理KV内存"为设计目标, 它颠覆的是, KV内存管理组件库, 复杂数据结构与持久化并不是它的初衷.

#### 2. memcache是用什么技术实现key过期的?

懒淘汰技术(lazy expiration)

#### 3. memcache为什么能保证运行性能, 且很少会出现内存碎片?

提前分配内存

#### 4. memcache为什么使用非阻塞IO复用网络模型, 使用监听线程/工作线程的多线程模型, 有什么优缺点?

目的提高吞吐量, 多线程能充分利用多核, 但会带来一些锁冲突.

### 第三类问题: 怎么做(how)

#### 1. memcahce是怎么实现内存管理, 以减少内存碎片, 是怎么实现内存分配的?

#### 2. 为什么不会出现内存碎片?

#### 3. 随着item的个数不断增多, hash冲突越来越大, hash表如何保证查询效率?

#### 4. memcache是怎么实现key过期的, 懒淘汰(lazy expiration)具体是怎么玩的?

#### 5. 挤掉哪个item?怎么挤?

